<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-Layer PCB Design - Analog Satellite Control System - Simón Aulet</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <header>
            <h1>6-Layer PCB Design - Analog Satellite Control System</h1>
            <p class="subtitle">Simón Aulet · KiCad · LTSpice · Analog Design · Multilayer PCB</p>
            <p class="description">Comprehensive KiCad design of an analog satellite control system implemented with discrete components. Includes LTSpice simulation of critical stages: hysteresis comparators, analog latches, timers, and power source switching.</p>
            <div class="tech-tags">
                <span>KiCad</span>
                <span>LTSpice</span>
                <span>6-Layer PCB</span>
                <span>Analog Design</span>
                <span>Simulation</span>
                <span>Satellite Control</span>
            </div>
            <div class="navigation">
                <a href="index.html" class="nav-link">← Back to Main Portfolio</a>
            </div>
        </header>

        <main>
            <div class="content-wrapper">
                <h2>6-Layer PCB Design for Analog Satellite Control System</h2>


                <div style="text-align: center; margin: 30px 0;">
                    <img src="../img/pcb.0.3Dboard1.png" alt="Main PCB Render" style="max-width: 100%; border: 2px solid #003366;">
                    <p style="text-align: center; font-style: italic; color: #555; margin-top: 10px;">3D render of main PCB - the analog brain of the satellite control system</p>
                </div>

                <blockquote>
                <p><strong>Project Repository:</strong> <a href="https://github.com/SimonAulet/portfolio/tree/main/PCB"><code>https://github.com/SimonAulet/portfolio/tree/main/PCB</code></a></p>
                <p style="font-size: 0.9em; margin-top: 8px; color: #555;">Contains all project files: KiCad schematics, PCB designs, LTSpice simulations, datasheets, and component libraries for direct import.</p>
                </blockquote>

                <h3>Context</h3>
                <p>Group development of an analog satellite control system implemented with discrete components. The system integrates orientation detection through photoresistors, thermal sensing, analog PWM generation, servomotor positioning, timing circuits, analog latches, and autonomous control logic.</p>

                <h3>My Contribution</h3>
                <p><strong>Comprehensive KiCad Design:</strong> Integration and physical development of the system from laboratory-implemented modules. This involves creating the unified schematic in KiCad, strategic selection of components compatible with industrial assembly, footprint and 3D model management, implementation of design classes for signal separation (analog, digital, power), critical routing, and exhaustive validation through ERC/DRC, culminating in a 6-layer PCB ready for manufacturing.</p>

                <p><strong>Analog Simulation and Validation:</strong> LTSpice simulation of key stages: hysteresis comparators (Schmitt trigger), analog PWM generator, timing circuits, decision logic for power source switching via relays, and latches implemented with NPN transistors.</p>

                <hr style="border: 1px solid #c41e3a; margin: 40px 0;" />

                <h2>Phase 1: Architecture</h2>

                <h3>General System</h3>
                <div style="text-align: center; margin: 30px 0;">
                    <img src="../img/pcb.0.schematic_root.jpg" alt="System Block Diagram" style="max-width: 100%; border: 2px solid #003366;">
                    <p style="text-align: center; font-style: italic; color: #555; margin-top: 10px;">Main schematic sheet - organized as interconnection map between subsystems</p>
                </div>

                <p>The design was structured into <strong>6 modular subsheets</strong>, each encapsulating a specific function:</p>

                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>Active filtering</strong> for LDR sensor signal conditioning</li>
                    <li><strong>Orientation sensing</strong> for eclipse/position detection</li>
                    <li><strong>Thermal control</strong> with LM35 sensing and actuation</li>
                    <li><strong>Solar panel deployment</strong> with PWM control and verification</li>
                    <li><strong>Deployment verification</strong> using 555 timers</li>
                    <li><strong>Power source selector</strong> for automatic switching between solar/battery</li>
                </ul>

                <p>Communication between modules was established through <strong>coherently named signals</strong> using prefixes. For example <code>A_</code> → Sensitive analog signals, <code>C_</code> → Commands and control signals, <code>F_</code> → Feedback, <code>L_</code> → LED indicators, etc. and suffixes to indicate input (<code>_I</code>) or output (<code>_O</code>)</p>

                <h3>Detailed Schematics</h3>
                <div style="margin: 30px 0; text-align: center;">
                    <iframe src="../img/pcb.schematic.pdf" width="100%" height="600px" style="border: 2px solid #003366;">
                        <p>Your browser does not support iframes. <a href="../img/pcb.schematic.pdf">Download PDF</a></p>
                    </iframe>
                    <p style="text-align: center; font-style: italic; color: #555; margin-top: 10px;">Complete system schematics</p>
                </div>

                <h3>Component Selection</h3>
                <p>Each component was chosen considering electrical specifications, availability, layout implications, and thermal/mechanical requirements. We attempted to use all from the same manufacturer (Texas Instruments) when possible:</p>

                <table>
                    <tr>
                        <th>Component</th>
                        <th>Manufacturer</th>
                        <th>Key Features</th>
                        <th>Selection Reason</th>
                    </tr>
                    <tr>
                        <td><strong>LM35</strong></td>
                        <td>Texas Instruments</td>
                        <td>Sensor de temperatura, TO-220</td>
                        <td>Allows direct screwing to batteries/heat sources for precise measurement</td>
                    </tr>
                    <tr>
                        <td><strong>LM358B</strong></td>
                        <td>Texas Instruments</td>
                        <td>Op-amp dual, SMD, 0.1µF en Vcc</td>
                        <td>Proven stability, integrated compensation, compact package</td>
                    </tr>
                    <tr>
                        <td><strong>CSD17577Q5A</strong></td>
                        <td>Texas Instruments</td>
                        <td>MOSFET N-ch, 25V, 6.7mΩ</td>
                        <td>Switching efficiency, low Rds(on), optimal for relays</td>
                    </tr>
                    <tr>
                        <td><strong>RT314009</strong></td>
                        <td>TE Connectivity</td>
                        <td>Relay 9V/16A, 1 Forma C</td>
                        <td>Current capacity for battery switching, coil compatible with 9V</td>
                    </tr>
                </table>

                <p><strong>Layout considerations:</strong> SMD packages were prioritized to reduce parasitic inductances, while components like the LM35 in TO-220 located in external sensors allowed robust mechanical mounting where direct thermal transfer was required.</p>

                <hr style="border: 1px solid #c41e3a; margin: 40px 0;" />

                <h2>Phase 2: Physical Implementation - 6-Layer PCB</h2>

                <h3>Stackup Strategy</h3>
                <p>The 6-layer distribution was optimized to ensure signal integrity and facilitate debugging, with clear function separation:</p>

                <table>
                    <tr>
                        <th>Layer</th>
                        <th>Designation</th>
                        <th>Main Content</th>
                        <th>Key Consideration</th>
                    </tr>
                    <tr>
                        <td><strong>1</strong></td>
                        <td>F.Cu (Top)</td>
                        <td>Critical analog signals</td>
                        <td>Accessible for measurement, short traces</td>
                    </tr>
                    <tr>
                        <td><strong>2</strong></td>
                        <td>In1.Cu</td>
                        <td>Continuous ground plane</td>
                        <td>Low impedance reference</td>
                    </tr>
                    <tr>
                        <td><strong>3</strong></td>
                        <td>In2.Cu</td>
                        <td>Power distribution</td>
                        <td>Separation between clean and general power</td>
                    </tr>
                    <tr>
                        <td><strong>4</strong></td>
                        <td>In3.Cu</td>
                        <td>Control signals and setpoints</td>
                        <td>Isolation from analog paths</td>
                    </tr>
                    <tr>
                        <td><strong>5</strong></td>
                        <td>In4.Cu</td>
                        <td>Interconnections and LEDs</td>
                        <td>Utility layer</td>
                    </tr>
                    <tr>
                        <td><strong>6</strong></td>
                        <td>B.Cu (Bottom)</td>
                        <td>Long-distance analog routes</td>
                        <td>"Highways" with predictable routing</td>
                    </tr>
                </table>

                <h3>Layer Visualization</h3>
                <div style="overflow-x: auto; margin: 30px 0; padding: 30px 0; background: #1a1a1a; border-radius: 8px;">
                  <div style="display: flex; gap: 20px; min-width: min-content; padding: 0 25px;">
                    <div style="flex-shrink: 0; width: 360px;">
                      <img src="../img/pcb.0.board1.png" alt="Layers 1 and 2" style="width: 100%; border-radius: 4px;">
                      <p style="text-align: center; color: #ccc; font-size: 1.0em; margin-top: 8px;">F.Cu + In1.Cu</p>
                    </div>
                    <div style="flex-shrink: 0; width: 360px;">
                      <img src="../img/pcb.0.board2.png" alt="Layers 3 and 4" style="width: 100%; border-radius: 4px;">
                      <p style="text-align: center; color: #ccc; font-size: 1.0em; margin-top: 8px;">In2.Cu + In3.Cu</p>
                    </div>
                    <div style="flex-shrink: 0; width: 360px;">
                      <img src="../img/pcb.0.board3.png" alt="Layers 5 and 6" style="width: 100%; border-radius: 4px;">
                      <p style="text-align: center; color: #ccc; font-size: 1.0em; margin-top: 8px;">In4.Cu + B.Cu</p>
                    </div>
                    <div style="flex-shrink: 0; width: 360px;">
                      <img src="../img/pcb.0.board4.png" alt="External Sensors" style="width: 100%; border-radius: 4px;">
                      <p style="text-align: center; color: #ccc; font-size: 1.0em; margin-top: 8px;">Sensory Modules</p>
                    </div>
                  </div>
                </div>

                <h3>Routing Methodology</h3>
                <p>Routing followed a strict hierarchy, prioritizing integrity over convenience:</p>

                <ol style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>Ground</strong> - Reference establishment with multiple vias</li>
                    <li><strong>Power</strong> - Traces dimensioned according to required current. Separation of IC power (<code>power_clean</code>) from general power</li>
                    <li><strong>Feedback signals</strong> - Direct and protected routes</li>
                    <li><strong>Analog signals</strong> - Length minimization and crossing avoidance</li>
                    <li><strong>Control and LEDs</strong> - Completion of interconnections</li>
                </ol>

                <p>This sequence ensured that the most sensitive signals had optimal routes before compromising space with secondary functionalities.</p>

                <h3>External Subsystems and Connectivity</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 30px; margin: 30px 0; align-items: flex-start;">
                    <div style="flex: 1 1 300px; min-width: 300px;">
                        <img src="../img/pcb.0.3Dboard4.png" alt="External Sensory Modules" style="width: 100%; border: 2px solid #003366;">
                        <p style="text-align: center; font-style: italic; color: #555; margin-top: 10px;">Distributed sensors and actuators - modular solution with clearly identified connectivity</p>
                    </div>
                    <div style="flex: 1 1 300px; min-width: 300px;">
                        <p>The complete system extends beyond the main PCB through external modules:</p>

                        <ul style="margin-left: 20px; margin-bottom: 20px;">
                            <li><strong>4 light detection modules</strong>, each with 1 LDR for omnidirectional coverage.</li>
                            <li><strong>2 LM35 temperature sensors</strong> for thermal monitoring in critical locations.</li>
                            <li><strong>1 heater module</strong> activated by the low temperature alert signal.</li>
                            <li><strong>2 limit switches</strong> for physical detection of solar panel opening and closing.</li>
                        </ul>

                        <p>Each module is a <strong>square double-layer PCB</strong> with holes for robust mechanical mounting. Interconnection with the main board is done through cables connected to <strong>labeled terminal blocks at both ends</strong>, ensuring error-free installation and facilitating maintenance or individual replacement of any subsystem without affecting the whole.</p>
                    </div>
                </div>
                <style>
                    @media (max-width: 768px) {
                        .content-wrapper div[style*="display: flex"] {
                            flex-direction: column !important;
                        }
                        .content-wrapper div[style*="min-width: 300px"] {
                            min-width: 100% !important;
                            margin-bottom: 20px;
                        }
                    }
                </style>

                <h3>Key Design Points</h3>
                <ul style="margin-left: 20px; margin-bottom: 20px;">
                    <li><strong>Effective domain separation:</strong> The 63 signals organized into classes allowed applying consistent and automated design rules.</li>
                    <li><strong>Successful hierarchical routing:</strong> Starting with reference and power, then critical signals, finally secondary functionalities.</li>
                    <li><strong>Built-in debugging:</strong> All critical signals accessible on external layers, with space for test points where necessary.</li>
                    <li><strong>Exceeded specification compliance:</strong> The final design exceeds the minimum clearance and trace width requirements of the selected manufacturer.</li>
                </ul>

                <hr style="border: 1px solid #c41e3a; margin: 40px 0;" />

                <h2>Simulation and Analytical Validation</h2>

                <p>Each critical subsystem of the design was modeled and validated in LTSpice before any physical implementation. Starting from functional requirements —hysteresis comparators, analog latches, timers, and PWM generators— models were built using real components, such as the LM358 opamp configured according to its Texas Instruments datasheet, and PWL signals to simulate operational conditions.</p>

                <p>This simulation process allowed optimizing component values, verifying design margins, and predicting system behavior with high accuracy. The results were then successfully correlated with breadboard measurements using a high-end Tektronix oscilloscope, establishing a solid foundation for the final PCB design.</p>

                <h3>1. Hysteresis Comparator (Schmitt Trigger)</h3>

                <p>Hysteresis was implemented to eliminate switching oscillations with noisy or slowly varying signals. The circuit was modeled in LTSpice and characterized both analytically and experimentally.</p>

                <div style="overflow-x: auto; margin: 30px 0; padding: 20px 0; background: #ffffff; border-radius: 8px;">
                  <div style="display: flex; gap: 20px; min-width: min-content; padding: 0 20px;">
                    <div style="flex-shrink: 0; width: 442px;">
                      <img src="../img/pcb.1.1.circuit.png" alt="Schmitt Trigger Circuit in LTSpice" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">Circuit implemented in LTSpice</p>
                    </div>
                    <div style="flex-shrink: 0; width: 442px;">
                      <img src="../img/pcb.1.6.hysteresis_calculations.png" alt="Analytical hysteresis calculation" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">Analytical calculation: H = 0.43 V</p>
                    </div>
                  </div>
                </div>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.1.5.hysteresis_characteristics.png" alt="Hysteresis measurement in simulation" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Simulation validation: ΔV = 425 mV between thresholds</p>
                </div>

                <p>The simulation with a triangular ramp confirms that switching occurs with a 425 mV difference between rising and falling edges, in excellent agreement with the theoretical calculation of 430 mV. This ensures noise immunity and stability in threshold detection.</p>

                <div style="overflow-x: auto; margin: 30px 0; padding: 20px 0; background: #ffffff; border-radius: 8px;">
                  <div style="display: flex; gap: 20px; min-width: min-content; padding: 0 20px;">
                    <div style="flex-shrink: 0; width: 442px;">
                      <img src="../img/pcb.1.2.inverting_schmitt.png" alt="Inverting Schmitt trigger" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">Inverting configuration with noise</p>
                    </div>
                    <div style="flex-shrink: 0; width: 442px;">
                      <img src="../img/pcb.1.3.non-inverting_schmitt.png" alt="Non-inverting Schmitt trigger" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">Non-inverting configuration</p>
                    </div>
                    <div style="flex-shrink: 0; width: 442px;">
                      <img src="../img/pcb.1.4.non-hysteretic_comparator.png" alt="Comparator without hysteresis" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">Without hysteresis: oscillations at threshold</p>
                    </div>
                  </div>
                </div>

                <p>The waveforms demonstrate the design's effectiveness: while the comparator without hysteresis shows multiple unwanted switching events when crossing the threshold, both Schmitt trigger configurations maintain a clean and stable output even with noisy input signals.</p>

                <h3>2. Analog Timing and Alarm Logic</h3>

                <p>The timing subsystem integrates a 555 timer, a custom anti-latch circuit, and alarm enable logic to ensure error signals activate only under valid conditions.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.5.1.circuit.png" alt="Complete timing circuit" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Complete circuit: 555 timer, alarm logic, and latch-to-pulse converter</p>
                </div>

                <h4>Latch-to-Pulse Converter</h4>
                <p>Original design that solves a specific requirement: the 555 needs an edge, not a sustained signal. Implemented with an LM358 and 5 µF capacitor, it generates a short pulse on each rising edge of the input, ignoring its subsequent state. Used twice in the system (for opening and closing panel verification).</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.5.3.latch-to-pulse(annotated).png" alt="Latch-to-pulse converter" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Annotated latch-to-pulse converter - converts continuous signal to activation pulse</p>
                </div>

                <h4>555 Timer Behavior</h4>
                <p>The 555 operates with active-low output. The simulation shows two activation modes: through reset signal (undesired, requiring filtering) and through a valid trigger after the timing period.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.5.5.out(annotated).png" alt="555 timer output" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Activation by reset (left) and by valid trigger (right)</p>
                </div>

                <h4>Alarm Enable Logic</h4>
                <p>Implemented with an opamp as comparator, it acts as an analog AND gate to avoid false positives during system reset. Only when the trigger is active (low) <em>and</em> the reset is inactive (high) is the alarm signal generated.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.5.7.alarm_logic(annotated).png" alt="Alarm enable logic" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Analog AND logic: alarm only with active trigger and inactive reset</p>
                </div>

                <h3>3. Analog Latch with NPN Transistors</h3>

                <p>Simple latch implemented with two cross-coupled NPN transistors that maintains a stable state (ON/OFF) until receiving an opposite switching signal. Used to retain the deployment state of solar panels.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.2.1.circuit.jpeg" alt="Latch circuit with NPN transistors" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Analog latch: cross-coupled NPN transistor configuration for state retention</p>
                </div>

                <div style="overflow-x: auto; margin: 30px 0; padding: 20px 0; background: #ffffff; border-radius: 8px;">
                  <div style="display: flex; gap: 20px; min-width: min-content; padding: 0 20px; justify-content: center;">
                    <div style="flex-shrink: 0; width: 494px;">
                      <img src="../img/pcb.2.2.q1(on).png" alt="Latch with Q1 active" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">State 1: Q1 active, Q2 inactive - stable output</p>
                    </div>
                    <div style="flex-shrink: 0; width: 494px;">
                      <img src="../img/pcb.2.3.q2(off).png" alt="Latch with Q2 active" style="width: 100%; border-radius: 4px; border: 2px solid #003366;">
                      <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 8px;">State 2: Q2 active, Q1 inactive - clean switching</p>
                    </div>
                  </div>
                </div>

                <p>The latch responds correctly to input pulses, maintaining the last activated state without additional consumption until the next switching. The simulation confirms stable transition between states without oscillations.</p>

                <h3>4. Power Source Switching with MOSFET</h3>

                <p>Control stage for relay activation through MOSFETs, managing selection between solar source and batteries. The simulation focuses on MOSFET behavior, as the relay operates as a controlled inductive load.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.4.1.circuit.png" alt="Switching circuit with MOSFET" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">MOSFET driver with protection and control signal from comparator</p>
                </div>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.4.3.switching(annotated).png" alt="Annotated switching waveform" style="max-width: 100%;
                </div>

                <p>The MOSFET CSD17577Q5A responds efficiently to the control signal, with fast switching times and no oscillations. The simulation validates that the design correctly handles the transition between power sources.</p>

                <h3>5. Orientation Sensor Simulation with LDR</h3>

                <p>Simulation of the orientation detection circuit that uses an LDR (Light Dependent Resistor) in resistive divider configuration followed by a comparator. To model LDR resistance variation in LTSpice, a creative solution was implemented: a variable PWL voltage source that controls a resistor value through the expression <code>R = V(VR) * 100000</code>, effectively simulating a time-varying resistance.</p>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.3.1.circuit.png" alt="LDR sensor circuit with simulated variable resistance" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">Resistive divider with "variable LDR" (PWL-controlled source) and comparator stage</p>
                </div>

                <div style="margin: 30px 0; text-align: center;">
                  <img src="../img/pcb.3.3.waveform(annotated).png" alt="Annotated detection waveform" style="max-width: 100%; border-radius: 6px; border: 2px solid #003366;">
                  <p style="text-align: center; font-size: 0.9em; color: #555; margin-top: 10px;">System response: divider voltage (variable, blue) and comparator output (step, red)</p>
                </div>

                <p>The simulation confirms that the circuit correctly detects when illumination (simulated as variable resistance) crosses the established threshold, generating a clean transition in the comparator output.</p>
            </div>
        </main>
        <div id="footer-container"></div>
    </div>
    <script>
        fetch('../components/footer-general_en.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });
    </script>
</body>
</html>
